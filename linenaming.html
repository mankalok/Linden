<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››é‚Šå½¢å­¸ç¿’éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#7868E6', // æ›´æŸ”å’Œçš„ç´«è‰²
                        secondary: '#FFCF96', // æº«æš–çš„æ©˜è‰²
                        success: '#5CB85C', // å¿«æ¨‚çš„ç¶ è‰²
                        error: '#FF7D7D', // æŸ”å’Œçš„ç´…è‰²
                        happy: '#FFE15D', // æ„‰æ‚…çš„é»ƒè‰²
                    }
                }
            }
        }

        // æª¢æ¸¬æš—é»‘æ¨¡å¼
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    <style>
        /* ç¢ºä¿åé¥‹ä¿¡æ¯é¡¯ç¤ºåœ¨æœ€é ‚å±¤ */
        #feedback {
            z-index: 50;
        }
        
        /* å¢åŠ å‹•ç•«æ•ˆæœ */
        .highlight-animation {
            animation: pulse 1s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.9; }
        }
        
        /* æŒ‰éˆ•é»æ“Šæ•ˆæœ */
        .button-press {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        /* æ„‰å¿«çš„èƒŒæ™¯ç´‹ç† */
        .happy-bg {
            background-image: radial-gradient(#F9F9F9 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .dark .happy-bg {
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        /* å½©è™¹é‚Šæ¡†æ•ˆæœ */
        @keyframes rainbow-border {
            0% { box-shadow: 0 0 0 3px rgba(255, 207, 150, 0.5); }
            25% { box-shadow: 0 0 0 3px rgba(120, 104, 230, 0.5); }
            50% { box-shadow: 0 0 0 3px rgba(92, 184, 92, 0.5); }
            75% { box-shadow: 0 0 0 3px rgba(255, 125, 125, 0.5); }
            100% { box-shadow: 0 0 0 3px rgba(255, 207, 150, 0.5); }
        }
        
        .rainbow-glow {
            animation: rainbow-border 3s infinite;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-primary dark:text-secondary mb-2">
            <span class="inline-block animate-bounce mr-2">ğŸ®</span> 
            å››é‚Šå½¢å­¸ç¿’éŠæˆ²
            <span class="inline-block animate-bounce ml-2">ğŸ¯</span>
        </h1>
        <p class="text-center text-gray-600 dark:text-gray-300 mb-6">å¿«æ¨‚å­¸ç¿’å››é‚Šå½¢ä¸­é‚Šçš„å‘½åå§ï¼</p>
        
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden p-4 md:p-6 mb-6 rainbow-glow transition-all duration-300">
            <!-- éŠæˆ²æ§åˆ¶å€ -->
            <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                <div class="flex mb-4 md:mb-0">
                    <button id="startBtn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full mr-3 transform transition-transform duration-200 hover:scale-105 active:scale-95 shadow-md">
                        <span class="mr-2">ğŸš€</span> é–‹å§‹éŠæˆ²
                    </button>
                    <button id="nextBtn" class="bg-secondary hover:bg-secondary/90 text-gray-700 font-bold py-2 px-6 rounded-full transform transition-transform duration-200 hover:scale-105 active:scale-95 shadow-md" disabled>
                        <span class="mr-2">ğŸ‘‰</span> ä¸‹ä¸€é¡Œ
                    </button>
                </div>
                <div class="flex items-center bg-gray-100 dark:bg-gray-700 py-2 px-4 rounded-full">
                    <span class="text-gray-700 dark:text-gray-200 mr-2">å¾—åˆ†ï¼š</span>
                    <span id="score" class="text-xl font-bold text-primary">0</span>
                    <span class="ml-2">ğŸ†</span>
                </div>
            </div>
            
            <!-- éŠæˆ²å€åŸŸ -->
            <div class="relative bg-gray-50 dark:bg-gray-700 rounded-2xl p-3 mb-6 happy-bg shadow-inner" style="min-height: 350px;">
                <!-- å››é‚Šå½¢é¡¯ç¤ºå€ -->
                <div id="shapeContainer" class="flex justify-center items-center h-[350px]">
                    <div id="svgContainer" class="relative mx-auto" style="width:300px;height:300px;">
                        <svg id="shapeSvg" width="300" height="300" class="absolute top-0 left-0"></svg>
                        <!-- é»æ“Šå€åŸŸç”¨divè¦†è“‹ -->
                        <div id="clickOverlay" class="absolute top-0 left-0 w-full h-full"></div>
                    </div>
                </div>
                
                <!-- å•é¡Œé¡¯ç¤º -->
                <div id="questionDisplay" class="text-xl text-center font-bold py-3 text-primary dark:text-secondary hidden">
                    <span class="inline-block mr-2">ğŸ¤”</span>
                    è«‹é»é¸ç·šæ®µ <span id="targetSegment" class="text-primary dark:text-happy px-2 py-1 bg-gray-100 dark:bg-gray-600 rounded-lg font-mono">AB</span>
                </div>
                
                <!-- å€’æ•¸è¨ˆæ™‚å™¨ -->
                <div id="timer" class="absolute top-3 right-3 w-12 h-12 bg-primary text-white font-bold text-xl hidden rounded-full flex items-center justify-center shadow-lg transform transition-transform duration-300">
                    5
                </div>
                
                <!-- å››é‚Šå½¢é¡å‹é¡¯ç¤º -->
                <div id="shapeTypeDisplay" class="absolute top-3 left-3 bg-secondary dark:bg-secondary/80 rounded-full px-3 py-1 text-gray-700 font-medium">
                    ç­‰å¾…é–‹å§‹...
                </div>
                
                <!-- é–‹å§‹æç¤º -->
                <div id="startPrompt" class="absolute inset-0 flex items-center justify-center">
                    <div class="text-xl text-center text-gray-600 dark:text-gray-300 bg-white/80 dark:bg-gray-800/80 p-6 rounded-xl shadow-lg">
                        <div class="text-4xl mb-3">ğŸ‘‡</div>
                        é»æ“Šã€Œé–‹å§‹éŠæˆ²ã€æŒ‰éˆ•é–‹å§‹å­¸ç¿’å››é‚Šå½¢ï¼
                    </div>
                </div>
                
                <!-- åé¥‹è¨Šæ¯ -->
                <div id="feedback" class="absolute inset-x-0 bottom-4 mx-auto w-4/5 text-center p-4 rounded-xl hidden highlight-animation shadow-lg text-lg">
                </div>
            </div>
            
            <!-- èªªæ˜å€ -->
            <div class="bg-gray-50 dark:bg-gray-700 p-5 rounded-xl text-sm text-gray-700 dark:text-gray-200 shadow-inner">
                <p class="font-bold mb-3 flex items-center">
                    <span class="text-xl mr-2">ğŸ“</span> éŠæˆ²ç©æ³•ï¼š
                </p>
                <ul class="space-y-2 ml-2">
                    <li class="flex items-start">
                        <span class="inline-block mr-2 text-happy">ğŸ”¶</span>
                        <span>ç•«é¢æœƒéš¨æ©Ÿé¡¯ç¤ºä¸€ç¨®å››é‚Šå½¢ï¼ˆæ­£æ–¹å½¢ã€é•·æ–¹å½¢ã€å¹³è¡Œå››é‚Šå½¢ã€æ¢¯å½¢æˆ–è±å½¢ï¼‰</span>
                    </li>
                    <li class="flex items-start">
                        <span class="inline-block mr-2 text-happy">ğŸ”¶</span>
                        <span>é ‚é»æœƒä»¥<b>éš¨æ©Ÿ</b>å¤§å¯«è‹±æ–‡å­—æ¯æ¨™ç¤ºï¼ˆå¾26å€‹å­—æ¯ä¸­éš¨æ©ŸæŠ½å–4å€‹ï¼‰</span>
                    </li>
                    <li class="flex items-start">
                        <span class="inline-block mr-2 text-happy">ğŸ”¶</span>
                        <span>ä½ éœ€è¦åœ¨5ç§’å…§æ‰¾å‡ºä¸¦é»æ“Šé¡Œç›®è¦æ±‚çš„ç·šæ®µ</span>
                    </li>
                    <li class="flex items-start">
                        <span class="inline-block mr-2 text-happy">ğŸ”¶</span>
                        <span>ç­”å°æœƒå¾—åˆ°1åˆ†ï¼Œç­”éŒ¯æ²’æœ‰æ‰£åˆ†</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('startBtn');
            const nextBtn = document.getElementById('nextBtn');
            const shapeSvg = document.getElementById('shapeSvg');
            const clickOverlay = document.getElementById('clickOverlay');
            const questionDisplay = document.getElementById('questionDisplay');
            const targetSegment = document.getElementById('targetSegment');
            const timer = document.getElementById('timer');
            const feedback = document.getElementById('feedback');
            const scoreDisplay = document.getElementById('score');
            const startPrompt = document.getElementById('startPrompt');
            const shapeTypeDisplay = document.getElementById('shapeTypeDisplay');
            
            let score = 0;
            let currentShape = null;
            let currentSegments = [];
            let targetSegmentIndex = -1;
            let countdownInterval = null;
            let timeLeft = 5;
            let gameActive = false;
            
            // å››é‚Šå½¢é¡å‹
            const shapeTypes = [
                { name: 'square', generator: generateSquare, nameZh: 'æ­£æ–¹å½¢ â–¡' },
                { name: 'rectangle', generator: generateRectangle, nameZh: 'é•·æ–¹å½¢ â–­' },
                { name: 'parallelogram', generator: generateParallelogram, nameZh: 'å¹³è¡Œå››é‚Šå½¢ â–±' },
                { name: 'trapezoid', generator: generateTrapezoid, nameZh: 'æ¢¯å½¢ â¢' },
                { name: 'rhombus', generator: generateRhombus, nameZh: 'è±å½¢ â—‡' }
            ];
            
            // æŒ‰éˆ•é»æ“Šæ•ˆæœ
            startBtn.addEventListener('mousedown', function() {
                this.classList.add('button-press');
            });
            
            startBtn.addEventListener('mouseup', function() {
                this.classList.remove('button-press');
            });
            
            nextBtn.addEventListener('mousedown', function() {
                this.classList.add('button-press');
            });
            
            nextBtn.addEventListener('mouseup', function() {
                this.classList.remove('button-press');
            });
            
            // é–‹å§‹éŠæˆ²
            startBtn.addEventListener('click', startGame);
            nextBtn.addEventListener('click', nextQuestion);
            
            // éŠæˆ²åˆå§‹åŒ–
            function startGame() {
                console.log("éŠæˆ²é–‹å§‹");
                score = 0;
                scoreDisplay.textContent = score;
                startBtn.innerHTML = '<span class="mr-2">ğŸ”„</span> é‡æ–°é–‹å§‹';
                nextBtn.disabled = true;
                startPrompt.classList.add('hidden');
                playSound('start');
                nextQuestion();
            }
            
            // æ¨¡æ“¬éŸ³æ•ˆæ’­æ”¾ï¼ˆç”±æ–¼ç’°å¢ƒé™åˆ¶ï¼Œå¯¦éš›ä¸ç™¼è²ï¼‰
            function playSound(type) {
                console.log(`æ’­æ”¾${type}éŸ³æ•ˆ`);
                // å¯¦éš›ç¶²é ä¸­å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼æ’­æ”¾éŸ³æ•ˆ
                // const sound = new Audio(`sounds/${type}.mp3`);
                // sound.play();
            }
            
            // ç”Ÿæˆ4å€‹éš¨æ©Ÿä¸é‡è¤‡çš„è‹±æ–‡å­—æ¯
            function generateRandomLetters() {
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const selectedLetters = [];
                const usedIndices = new Set();
                
                while (selectedLetters.length < 4) {
                    const randomIndex = Math.floor(Math.random() * 26);
                    if (!usedIndices.has(randomIndex)) {
                        selectedLetters.push(letters[randomIndex]);
                        usedIndices.add(randomIndex);
                    }
                }
                
                return selectedLetters;
            }
            
            // ä¸‹ä¸€é¡Œ
            function nextQuestion() {
                console.log("ç”¢ç”Ÿæ–°é¡Œç›®");
                clearInterval(countdownInterval);
                feedback.classList.add('hidden');
                
                // éš¨æ©Ÿé¸æ“‡ä¸€ç¨®å››é‚Šå½¢
                const randomShapeType = shapeTypes[Math.floor(Math.random() * shapeTypes.length)];
                currentShape = randomShapeType;
                
                // æ›´æ–°å››é‚Šå½¢é¡å‹é¡¯ç¤º
                shapeTypeDisplay.textContent = currentShape.nameZh;
                
                // æ¸…ç©ºSVGå’Œé»æ“Šå€åŸŸ
                while (shapeSvg.firstChild) {
                    shapeSvg.removeChild(shapeSvg.firstChild);
                }
                clickOverlay.innerHTML = '';
                
                // ç”Ÿæˆéš¨æ©Ÿå­—æ¯
                const randomLetters = generateRandomLetters();
                console.log("éš¨æ©Ÿç”Ÿæˆçš„å­—æ¯:", randomLetters.join(", "));
                
                // ç”Ÿæˆå››é‚Šå½¢
                const vertices = currentShape.generator(randomLetters);
                drawShape(vertices);
                
                // éš¨æ©Ÿé¸æ“‡ä¸€å€‹ç·šæ®µä½œç‚ºç›®æ¨™
                targetSegmentIndex = Math.floor(Math.random() * currentSegments.length);
                const segment = currentSegments[targetSegmentIndex];
                targetSegment.textContent = `${segment.startLabel}${segment.endLabel}`;
                
                // é¡¯ç¤ºå•é¡Œ
                questionDisplay.classList.remove('hidden');
                
                // é–‹å§‹å€’æ•¸è¨ˆæ™‚
                timeLeft = 5;
                timer.textContent = timeLeft;
                timer.classList.remove('hidden');
                // é‡ç½®è¨ˆæ™‚å™¨é¡è‰²
                timer.classList.remove('bg-error');
                timer.classList.add('bg-primary');
                gameActive = true;
                
                // æ·»åŠ ç¸®æ”¾å‹•ç•«
                timer.classList.add('highlight-animation');
                
                console.log("é–‹å§‹è¨ˆæ™‚");
                countdownInterval = setInterval(updateTimer, 1000);
                nextBtn.disabled = true;
                
                // å•Ÿç”¨ä¸‹ä¸€é¡ŒæŒ‰éˆ•
                nextBtn.innerHTML = '<span class="mr-2">ğŸ‘‰</span> ä¸‹ä¸€é¡Œ';
            }
            
            // æ›´æ–°è¨ˆæ™‚å™¨
            function updateTimer() {
                timeLeft--;
                timer.textContent = timeLeft;
                
                // æ™‚é–“å¿«åˆ°æ™‚æ”¹è®Šé¡è‰²
                if (timeLeft <= 2) {
                    timer.classList.remove('bg-primary');
                    timer.classList.add('bg-error');
                }
                
                console.log("å€’æ•¸è¨ˆæ™‚ï¼š", timeLeft);
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    gameActive = false;
                    
                    // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
                    highlightSegment(currentSegments[targetSegmentIndex], 'red');
                    showFeedback('âŒ æ™‚é–“åˆ°ï¼æ­£ç¢ºç­”æ¡ˆå·²é¡¯ç¤ºã€‚åˆ¥æ“”å¿ƒï¼Œä¸‹ä¸€é¡Œå†åŠ æ²¹å§ï¼ ğŸ’ª', 'bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100');
                    
                    nextBtn.disabled = false;
                    playSound('timeout');
                }
            }
            
            // ç”Ÿæˆå„ç¨®å››é‚Šå½¢çš„é ‚é»åº§æ¨™
            function generateSquare(letters = ['A', 'B', 'C', 'D']) {
                const size = 120;
                const center = { x: 150, y: 150 };
                return [
                    { x: center.x - size/2, y: center.y - size/2, label: letters[0] },
                    { x: center.x + size/2, y: center.y - size/2, label: letters[1] },
                    { x: center.x + size/2, y: center.y + size/2, label: letters[2] },
                    { x: center.x - size/2, y: center.y + size/2, label: letters[3] }
                ];
            }
            
            function generateRectangle(letters = ['A', 'B', 'C', 'D']) {
                const width = 160;
                const height = 100;
                const center = { x: 150, y: 150 };
                return [
                    { x: center.x - width/2, y: center.y - height/2, label: letters[0] },
                    { x: center.x + width/2, y: center.y - height/2, label: letters[1] },
                    { x: center.x + width/2, y: center.y + height/2, label: letters[2] },
                    { x: center.x - width/2, y: center.y + height/2, label: letters[3] }
                ];
            }
            
            function generateParallelogram(letters = ['A', 'B', 'C', 'D']) {
                const width = 160;
                const height = 100;
                const skew = 40;
                const center = { x: 150, y: 150 };
                return [
                    { x: center.x - width/2 + skew, y: center.y - height/2, label: letters[0] },
                    { x: center.x + width/2 + skew, y: center.y - height/2, label: letters[1] },
                    { x: center.x + width/2 - skew, y: center.y + height/2, label: letters[2] },
                    { x: center.x - width/2 - skew, y: center.y + height/2, label: letters[3] }
                ];
            }
            
            function generateTrapezoid(letters = ['A', 'B', 'C', 'D']) {
                const topWidth = 100;
                const bottomWidth = 180;
                const height = 100;
                const center = { x: 150, y: 150 };
                return [
                    { x: center.x - topWidth/2, y: center.y - height/2, label: letters[0] },
                    { x: center.x + topWidth/2, y: center.y - height/2, label: letters[1] },
                    { x: center.x + bottomWidth/2, y: center.y + height/2, label: letters[2] },
                    { x: center.x - bottomWidth/2, y: center.y + height/2, label: letters[3] }
                ];
            }
            
            function generateRhombus(letters = ['A', 'B', 'C', 'D']) {
                const width = 160;
                const height = 120;
                const center = { x: 150, y: 150 };
                return [
                    { x: center.x, y: center.y - height/2, label: letters[0] },
                    { x: center.x + width/2, y: center.y, label: letters[1] },
                    { x: center.x, y: center.y + height/2, label: letters[2] },
                    { x: center.x - width/2, y: center.y, label: letters[3] }
                ];
            }
            
            // ç¹ªè£½å››é‚Šå½¢
            function drawShape(vertices) {
                // ç¹ªè£½ç·šæ®µ
                currentSegments = [];
                
                for (let i = 0; i < vertices.length; i++) {
                    const next = (i + 1) % vertices.length;
                    
                    // å‰µå»ºç·šæ®µï¼ˆå¯è¦‹éƒ¨åˆ†ï¼‰
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', vertices[i].x);
                    line.setAttribute('y1', vertices[i].y);
                    line.setAttribute('x2', vertices[next].x);
                    line.setAttribute('y2', vertices[next].y);
                    line.setAttribute('stroke', '#7868E6'); // ä½¿ç”¨ä¸»è¦é¡è‰²
                    line.setAttribute('stroke-width', '3');
                    line.id = `line-${i}`;
                    
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        line.setAttribute('stroke', '#FFCF96'); // æš—æ¨¡å¼é¡è‰²
                    }
                    
                    shapeSvg.appendChild(line);
                    
                    // å„²å­˜ç·šæ®µä¿¡æ¯
                    currentSegments.push({
                        element: line,
                        startLabel: vertices[i].label,
                        endLabel: vertices[next].label,
                        startVertex: vertices[i],
                        endVertex: vertices[next]
                    });
                    
                    // ç‚ºæ¯å€‹ç·šæ®µåœ¨è¦†è“‹å±¤ä¸Šå‰µå»ºå¯¦éš›å¯é»æ“Šçš„å…ƒç´ ï¼ˆä½¿ç”¨divè€Œä¸æ˜¯SVGå…ƒç´ ï¼‰
                    createClickableSegment(vertices[i], vertices[next], i);
                }
                
                // ç¹ªè£½é ‚é»æ¨™ç±¤
                for (const vertex of vertices) {
                    // æ¨™ç±¤èƒŒæ™¯åœ“
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', vertex.x);
                    circle.setAttribute('cy', vertex.y);
                    circle.setAttribute('r', '15');
                    circle.setAttribute('fill', '#7868E6'); // ä½¿ç”¨ä¸»è¦é¡è‰²
                    
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        circle.setAttribute('fill', '#FFCF96'); // æš—æ¨¡å¼é¡è‰²
                    }
                    
                    shapeSvg.appendChild(circle);
                    
                    // æ¨™ç±¤æ–‡å­—
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', vertex.x);
                    text.setAttribute('y', vertex.y);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('dominant-baseline', 'central');
                    text.setAttribute('fill', 'white');
                    text.setAttribute('font-weight', 'bold');
                    text.setAttribute('font-size', '14');
                    text.textContent = vertex.label;
                    shapeSvg.appendChild(text);
                }
            }
            
            // å‰µå»ºå¯é»æ“Šç·šæ®µå€åŸŸ (ä½¿ç”¨HTMLå…ƒç´ è€ŒéSVG)
            function createClickableSegment(start, end, index) {
                // è¨ˆç®—ç·šæ®µè§’åº¦
                const angle = Math.atan2(end.y - start.y, end.x - start.x) * (180 / Math.PI);
                // è¨ˆç®—ç·šæ®µé•·åº¦
                const length = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));
                // è¨ˆç®—ç·šæ®µä¸­é»
                const midX = (start.x + end.x) / 2;
                const midY = (start.y + end.y) / 2;
                
                // å‰µå»ºå¯é»æ“Šå€åŸŸ
                const clickable = document.createElement('div');
                clickable.style.position = 'absolute';
                clickable.style.width = `${length}px`;
                clickable.style.height = '20px'; // è¼ƒå¯¬çš„é»æ“Šå€åŸŸ
                clickable.style.backgroundColor = 'transparent';
                clickable.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
                clickable.style.transformOrigin = 'center';
                clickable.style.left = `${midX}px`;
                clickable.style.top = `${midY}px`;
                clickable.style.cursor = 'pointer';
                clickable.dataset.index = index;
                clickable.id = `clickable-${index}`;
                
                // æ–¹ä¾¿é–‹ç™¼ï¼Œé‚Šç·£æ¨™ç¤ºï¼Œç”Ÿç”¢ç’°å¢ƒå¯ç§»é™¤
                // clickable.style.border = '1px solid rgba(255, 0, 0, 0.3)';
                
                // æ·»åŠ é»æ“Šäº‹ä»¶
                clickable.addEventListener('click', function() {
                    console.log("ç·šæ®µè¢«é»æ“Šï¼ŒéŠæˆ²ç‹€æ…‹:", gameActive, "é¸æ“‡çš„ç·šæ®µ:", index);
                    if (gameActive) {
                        const segmentIndex = parseInt(this.dataset.index);
                        checkAnswer(segmentIndex);
                    }
                });
                
                clickOverlay.appendChild(clickable);
            }
            
            // æª¢æŸ¥ç­”æ¡ˆ
            function checkAnswer(selectedIndex) {
                console.log("æª¢æŸ¥ç­”æ¡ˆ: é¸æ“‡çš„æ˜¯", selectedIndex, "ç›®æ¨™æ˜¯", targetSegmentIndex);
                clearInterval(countdownInterval);
                gameActive = false;
                
                if (selectedIndex === targetSegmentIndex) {
                    // ç­”å°äº†
                    highlightSegment(currentSegments[selectedIndex], 'green');
                    score++;
                    scoreDisplay.textContent = score;
                    
                    const praises = [
                        'âœ… å¤ªæ£’äº†ï¼ä½ ç­”å°äº†ï¼ ğŸ‰',
                        'âœ… çœŸå²å®³ï¼å›ç­”æ­£ç¢ºï¼ ğŸ‘',
                        'âœ… å®Œå…¨æ­£ç¢ºï¼åšå¾—å¾ˆå¥½ï¼ ğŸŒŸ',
                        'âœ… ä½ çœŸè°æ˜ï¼ç­”æ¡ˆæ­£ç¢ºï¼ ğŸ†',
                        'âœ… çœŸäº†ä¸èµ·ï¼ç­”å°äº†ï¼ ğŸ’¯'
                    ];
                    const randomPraise = praises[Math.floor(Math.random() * praises.length)];
                    showFeedback(randomPraise, 'bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100');
                    playSound('correct');
                } else {
                    // ç­”éŒ¯äº†
                    highlightSegment(currentSegments[selectedIndex], 'red');
                    
                    // çŸ­æš«å»¶é²å¾Œé¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
                    setTimeout(() => {
                        highlightSegment(currentSegments[targetSegmentIndex], 'green');
                    }, 500);
                    
                    const segment = currentSegments[targetSegmentIndex];
                    const encouragements = [
                        `âŒ ä¸è¦æ°£é¤’ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ç·šæ®µ${segment.startLabel}${segment.endLabel}ï¼Œä¹Ÿå°±æ˜¯å¾${segment.startLabel}é»åˆ°${segment.endLabel}é»çš„ç·šæ®µã€‚ ğŸ’ª`,
                        `âŒ å·®ä¸€é»é»ï¼ç·šæ®µ${segment.startLabel}${segment.endLabel}æ˜¯å¾${segment.startLabel}é»åˆ°${segment.endLabel}é»çš„ç·šæ®µã€‚ ğŸ¤—`,
                        `âŒ ç¹¼çºŒåŠªåŠ›ï¼ç·šæ®µ${segment.startLabel}${segment.endLabel}é€£æ¥çš„æ˜¯${segment.startLabel}é»å’Œ${segment.endLabel}é»ã€‚ ğŸ“š`,
                        `âŒ å†è©¦ä¸€æ¬¡ï¼ç·šæ®µ${segment.startLabel}${segment.endLabel}è¡¨ç¤ºçš„æ˜¯å¾é ‚é»${segment.startLabel}åˆ°é ‚é»${segment.endLabel}çš„é‚Šã€‚ ğŸŒˆ`
                    ];
                    const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                    showFeedback(randomEncouragement, 'bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100');
                    playSound('incorrect');
                }
                
                // ç‰¹æ®Šæ•ˆæœï¼šåˆ†æ•¸å¢åŠ æ™‚çš„å‹•ç•«
                if (selectedIndex === targetSegmentIndex) {
                    scoreDisplay.classList.add('highlight-animation');
                    setTimeout(() => {
                        scoreDisplay.classList.remove('highlight-animation');
                    }, 1000);
                }
                
                timer.classList.add('hidden');
                nextBtn.disabled = false;
            }
            
            // æ¨™ç¤ºç·šæ®µ
            function highlightSegment(segment, color) {
                console.log("é«˜äº®é¡¯ç¤ºç·šæ®µ:", segment.startLabel + segment.endLabel, "é¡è‰²:", color);
                
                // ç›´æ¥è¨­ç½®SVGå±¬æ€§
                if (color === 'green') {
                    segment.element.setAttribute('stroke', '#5CB85C'); // ç¶ è‰²
                    segment.element.setAttribute('stroke-width', '5');
                } else if (color === 'red') {
                    segment.element.setAttribute('stroke', '#FF7D7D'); // ç´…è‰²
                    segment.element.setAttribute('stroke-width', '5');
                }
                
                // æ·»åŠ é–ƒçˆå‹•ç•«
                segment.element.classList.add('highlight-animation');
            }
            
            // é¡¯ç¤ºåé¥‹ä¿¡æ¯
            function showFeedback(message, colorClass) {
                console.log("é¡¯ç¤ºåé¥‹:", message);
                feedback.textContent = message;
                feedback.className = 'absolute inset-x-0 bottom-4 mx-auto w-4/5 text-center p-4 rounded-xl highlight-animation shadow-lg text-lg ' + colorClass;
                feedback.classList.remove('hidden');
                
                // å¼·åˆ¶é‡ç¹ª
                setTimeout(() => {
                    feedback.classList.add('highlight-animation');
                }, 10);
            }
        });
    </script>
</body>
</html>